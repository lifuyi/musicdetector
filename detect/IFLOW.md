# iFlow 项目上下文文档

## 项目概述

这是一个音乐分析项目，专注于音频处理、音乐理论分析和机器学习技术，旨在开发一个能够检测音乐调式（key）和和弦走向的应用程序。

## 项目结构

当前目录包含以下文件：
- `music_analyzer.py` - 核心音乐分析器实现
- `1.md` - 项目开发思路和技术栈文档（中文）
- `IFLOW.md` - 项目上下文文档（本文件）

## 核心功能

### 音乐分析器 (music_analyzer.py)
- **音频加载与预处理**：支持加载音频文件，转换为单声道并标准化
- **音高检测**：使用FFT频谱分析识别主要频率成分
- **和弦识别**：基于音乐理论规则识别和弦类型（大调、小调、减和弦、增和弦、七和弦等）
- **调性检测**：分析和弦走向确定音乐的调式
- **可视化输出**：生成和弦走向图和调式标记

### 技术栈
- **音频处理**：librosa库进行音频分析和频谱处理
- **数值计算**：numpy进行数学运算和频谱分析
- **机器学习**：scikit-learn的KMeans聚类算法
- **可视化**：matplotlib用于结果展示

## 开发环境设置

### 依赖安装
```bash
pip install librosa numpy matplotlib scikit-learn
```

### 运行示例
```bash
python music_analyzer.py
```

注意：需要准备音频文件（如 `sample_music.mp3`）作为分析输入

## 代码架构

### MusicAnalyzer 类
- `__init__()`：初始化音符频率映射和和弦模式定义
- `load_audio()`：加载音频文件并计算基本参数
- `detect_pitch()`：检测指定时间段的音高
- `identify_chord()`：根据音符识别和弦类型
- `analyze_chord_progression()`：分析整个音频的和弦走向
- `detect_key()`：基于和弦走向检测调性

## 使用场景

1. **音乐教育**：帮助学习者理解和弦构成和调式理论
2. **音乐制作**：分析现有音乐的和弦结构用于创作参考
3. **自动伴奏**：为音乐生成合适的和弦伴奏
4. **音乐转录**：将音频转换为和弦符号表示

## 扩展方向

根据 `1.md` 文档，项目可扩展为：
- **移动端应用**：使用Flutter或React Native构建跨平台应用
- **云端分析**：将复杂分析任务部署到云端处理
- **机器学习优化**：训练更精确的和弦识别模型
- **实时分析**：实现实时音频流和弦检测
- **多乐器支持**：处理复杂音乐中多乐器的和弦识别

## 关键挑战

- 复杂音乐中多乐器混合的和弦识别准确性
- 音频质量和噪音对分析结果的影响
- 不同音乐风格的适应性
- 实时分析的性能优化
- 计算资源限制（特别是移动端）

## 注意事项

- 当前实现为基础框架，实际应用中需要结合专业音频分析库
- 对于生产环境，建议使用已训练好的模型提高识别准确率
- 移动应用需要考虑计算资源限制，可能需要云端处理

## 文件说明

### music_analyzer.py
核心分析引擎，包含完整的音乐分析功能实现。代码结构清晰，注释详细，便于理解和扩展。

### 1.md
项目开发文档，详细描述了：
- 核心技术栈选择
- 实现步骤和架构设计
- 示例代码框架
- 扩展为完整应用的建议
- 关键挑战和解决方案

该文档为中文编写，提供了项目的完整开发思路和实现路径。